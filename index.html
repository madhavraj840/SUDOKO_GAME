<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>Sudoku Game</title>

    <!-- Local styles only (Poki requirement: no external CSS) -->
    <link rel="stylesheet" href="styles.css">

    <!-- ‚úÖ Poki SDK v2 (MANDATORY, Inspector-detected) -->
    <script src="https://game-cdn.poki.com/scripts/v2/poki-sdk.js"></script>
</head>

<body class="dark-mode">

<noscript>
    <div class="noscript-fallback">
        <h2>JavaScript Required</h2>
        <p>This game needs JavaScript to run. Please enable JavaScript and reload the page.</p>
    </div>
</noscript>

<!-- ================= START MENU SCREEN ================= -->
<div id="startScreen" class="screen active">
    <div class="screen-header">
        <button id="themeToggleStart" class="theme-toggle" title="Toggle dark mode">
            <span class="theme-icon">üåô</span>
        </button>
    </div>
    <div class="screen-content">
        <div class="game-title-container">
            <h1 id="gameLogoTitle" class="game-logo-title">Sudoku</h1>
        </div>
        <div class="menu-buttons">
            <button id="newGameMenuBtn" class="btn btn-primary btn-large">New Game</button>
            <button id="savedGameBtn" class="btn btn-secondary btn-large">Saved Game</button>
            <button id="dailyChallengeMenuBtn" class="btn btn-tertiary btn-large">Daily Challenge</button>
            <button id="customizeMenuBtn" class="btn btn-primary btn-large" style="background: #9c27b0;">üé® Customize</button>
            <div class="menu-language">
                <label id="languageLabel" class="language-label" for="languageSelect">Language</label>
                <select id="languageSelect" class="language-select" aria-label="Language">
                    <option value="en">English</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="it">Italiano</option>
                    <option value="de">Deutsch</option>
                    <option value="es">Espa√±ol</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- ================= DIFFICULTY SELECTION SCREEN ================= -->
<div id="difficultyScreen" class="screen">
    <div class="screen-header">
        <button id="difficultyBackBtn" class="back-btn">‚Üê Back</button>
        <button id="themeToggleDifficulty" class="theme-toggle" title="Toggle dark mode">
            <span class="theme-icon">üåô</span>
        </button>
    </div>
    <div class="screen-content">
        <h2 id="difficultyTitle" class="screen-title">Choose Difficulty Level</h2>
        <div class="difficulty-options">
            <button id="diffEasyBtn" class="btn btn-primary difficulty-large-btn">Easy</button>
            <button id="diffMediumBtn" class="btn btn-secondary difficulty-large-btn">Medium</button>
            <button id="diffHardBtn" class="btn btn-tertiary difficulty-large-btn">Hard</button>
        </div>
    </div>
</div>

<!-- ================= CUSTOMIZATION SCREEN ================= -->
<div id="customizationScreen" class="screen">
    <div class="screen-header">
        <button id="customizationBackBtn" class="back-btn">‚Üê Back</button>
        <div class="settings-menu">
            <button id="settingsMenuCustomization" class="settings-menu-btn" title="Settings" aria-haspopup="true" aria-expanded="false">‚öôÔ∏è</button>
            <div class="settings-menu-content" role="menu" aria-label="Settings menu">
                <button id="themeToggleCustomization" class="theme-toggle-btn" role="menuitem">Theme: Dark</button>
            </div>
        </div>
    </div>
    <div class="screen-content">
        <h2 id="customizationTitle" class="screen-title">Customize Theme</h2>
        <div class="coin-info-bar">
            <span id="customizationCoinCount">üí∞ 0</span>
        </div>
        <div id="themesList" class="themes-list"></div>
    </div>
</div>

<!-- ================= GAME CONTAINER ================= -->
<div id="gameScreen" class="screen">
    <div class="container">

    <div class="screen-header game-header">
        <div class="settings-menu">
            <button id="settingsMenuGame" class="settings-menu-btn" title="Settings" aria-haspopup="true" aria-expanded="false">‚öôÔ∏è</button>
            <div class="settings-menu-content" role="menu" aria-label="Settings menu">
                <button id="gameBackBtn" class="action-btn settings-menu-item" role="menuitem">‚Üê Menu</button>
                <button id="newGameBtn" class="action-btn settings-menu-item" role="menuitem">New Game</button>
                <button id="resetBtn" class="action-btn settings-menu-item" role="menuitem">Reset</button>
                <button id="solveBtn" class="action-btn settings-menu-item" role="menuitem">Solve</button>
                <button id="themeToggleGame" class="theme-toggle-btn" role="menuitem">Theme: Dark</button>
                <button id="orientationToggleBtn" class="action-btn settings-menu-item orientation-toggle-btn" role="menuitem">Orientation: Portrait</button>
                <button id="dailyChallengeBtn" class="action-btn settings-menu-item" role="menuitem">üìÖ Daily Challenge</button>
                <button id="leaderboardBtn" class="action-btn settings-menu-item" role="menuitem">üèÜ Leaderboard</button>
            </div>
        </div>
    </div>

    <div class="game-layout">
        <div class="game-left">
            <div class="header">
                <h1 id="gameTitle">Sudoku</h1>
            </div>

            <!-- In-game status and inline prompts (no popups) -->
            <div id="statusBar" class="status-bar" aria-live="polite"></div>
            <div id="adOverlay" class="ad-overlay hidden" aria-live="polite" aria-label="Ad playing">
            </div>
            <div id="inlinePrompt" class="inline-prompt hidden" role="dialog" aria-live="polite">
                <span id="promptText" class="prompt-text"></span>
                <div class="prompt-actions">
                    <button id="promptConfirm" class="btn btn-primary">OK</button>
                    <button id="promptCancel" class="btn btn-secondary">Cancel</button>
                </div>
            </div>

            <!-- Tutorial Panel -->
            <div id="tutorialPanel" class="tutorial-panel hidden" aria-live="polite">
                <div class="tutorial-content">
                    <h3 id="tutorialTitle">How to Play</h3>
                    <p id="tutorialStepText">Select a cell to begin.</p>
                    <div class="tutorial-actions">
                        <button id="tutorialNext" class="btn btn-primary">Next</button>
                        <button id="tutorialSkip" class="btn btn-secondary">Skip</button>
                    </div>
                </div>
            </div>

            <!-- Monetization: Coins and Rewards Display -->
            <div class="monetization-bar">
                <div class="coin-display">
                    <span>üí∞</span>
                    <span id="coinCount">0</span>
                </div>
                <div class="speed-boost-indicator" id="speedBoostIndicator" style="display: none;">
                    <span id="speedBoostActiveLabel" title="2x Coin bonus active">‚ö° 2x Active</span>
                </div>
                <button id="speedBoostBtn" class="reward-btn" title="Watch ad for 2x coins">‚ö° 2x Coins</button>
            </div>

            <!-- Engagement & Retention Panel -->
            <div class="engagement-panel">
                <div class="streak-info">
                    <span id="streakLabel">Streak</span>
                    <span id="streakCount">0</span>
                </div>
            </div>

            <div id="leaderboardPanel" class="panel hidden">
                <h3 id="leaderboardTitle">Leaderboard (Best Times)</h3>
                <ol id="leaderboardList" class="panel-list"></ol>
            </div>

            <!-- Sudoku Grid -->
            <div id="sudoku-grid" class="sudoku-grid"></div>
        </div>

        <div class="game-right">
            <div class="game-info">
                <div class="info-item">
                    <p><span id="difficultyTextLabel">Difficulty</span>: <span id="difficulty">Medium</span></p>
                </div>
                <div class="info-item">
                    <p><span id="timeLabel">Time</span>: <span id="timer">00:00</span></p>
                    <button id="pauseBtn" class="pause-btn" title="Pause game">‚è∏Ô∏è</button>
                </div>
            </div>

            <div class="side-grid">
                <button class="number-btn" data-number="1">1</button>
                <button class="number-btn" data-number="2">2</button>
                <button class="number-btn" data-number="3">3</button>
                <button class="number-btn" data-number="4">4</button>
                <button class="number-btn" data-number="5">5</button>
                <button class="number-btn" data-number="6">6</button>
                <button class="number-btn" data-number="7">7</button>
                <button class="number-btn" data-number="8">8</button>
                <button class="number-btn" data-number="9">9</button>
                <div class="side-grid-item hint-item">
                    <button id="hintBtn" class="hint-btn">
                        <span class="emoji">üí°</span>
                        <span id="hintButtonLabel">Get Hint</span>
                    </button>
                    <span id="hintCounter" class="hint-count">0</span>
                </div>
                <button class="number-btn clear-btn" id="clearBtn">Clear</button>
                <button id="undoBtn" class="action-btn">‚Ü∂ Undo</button>
                <div class="side-grid-spacer" aria-hidden="true"></div>
                <div class="side-grid-spacer" aria-hidden="true"></div>
                <div class="side-grid-spacer" aria-hidden="true"></div>
                <div class="side-grid-spacer" aria-hidden="true"></div>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Congratulations!</h2>
            <p id="modalMessage">You've completed the puzzle!</p>
            <button id="playAgainBtn" class="btn btn-primary">Play Again</button>
        </div>
    </div>

    </div>
</div>

<div id="settingsMenuOverlay" class="settings-menu-overlay hidden" aria-hidden="true"></div>

<!-- ================= POKI GLOBAL STATE ================= -->
<script>
    /**
     * Global Poki guards
     * These prevent duplicate events and Inspector warnings
     */
    window.__pokiReady = false;
    window.__pokiGameplayActive = false;

    // **POKI SDK v2: Initialize SDK on page load**
    if (typeof PokiSDK !== 'undefined') {
        PokiSDK.init()
            .then(() => {
                console.log('[Poki] SDK initialized successfully');
                window.__pokiReady = true;
            })
            .catch((error) => {
                console.warn('[Poki] SDK initialization failed:', error);
                window.__pokiReady = false;
            });
    } else {
        console.warn('[Poki] SDK script not loaded, running standalone mode');
        window.__pokiReady = false;
    }

    // **Prevent page scrolling inside Poki iframe (REQUIRED for Poki)**
    // Only intercept navigation keys when the Sudoku grid is focused
    window.addEventListener('keydown', e => {
        const grid = document.getElementById('sudoku-grid');
        const active = document.activeElement;
        const isGridFocused = grid && (grid.contains(e.target) || (active && grid.contains(active)));

        if (isGridFocused && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
            e.preventDefault();
        }
    });
    window.addEventListener('wheel', e => {
        const grid = document.getElementById('sudoku-grid');
        const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        if (!isTouchDevice && grid && grid.contains(e.target)) {
            e.preventDefault();
        }
    }, { passive: false });
</script>

<!-- ================= GAME LOGIC ================= -->
<script src="sudoku.js"></script>

</body>
</html>